# Data Engineering ‚Äî –†–∞–∑–¥–µ–ª 3. DWH (–•—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö)

**–ê–≤—Ç–æ—Ä:** –©–µ–≥–æ–ª–µ–≤ –ú–∏—Ö–∞–∏–ª  
**–ö—É—Ä—Å –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, 2025**

---

## üìò –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ –≤ DWH](#–≤–≤–µ–¥–µ–Ω–∏–µ-–≤-dwh)
2. [OLTP vs OLAP](#oltp-vs-olap)
3. [–ú–æ–¥–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è DWH](#–º–æ–¥–µ–ª–∏-–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è-dwh)
4. [SCD2 –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç—å—é –¥–∞–Ω–Ω—ã—Ö](#scd2-–∏-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç—å—é-–¥–∞–Ω–Ω—ã—Ö)
5. [–ú–∏–Ω–∏‚Äë–ø—Ä–æ–µ–∫—Ç: –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ ¬´–∑–≤—ë–∑–¥–æ—á–∫–∞¬ª](#–º–∏–Ω–∏–ø—Ä–æ–µ–∫—Ç-–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–º–æ–¥–µ–ª–∏-–∑–≤—ë–∑–¥–æ—á–∫–∞)
6. [–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ GPT‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∏](#–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ-–≤–æ–ø—Ä–æ—Å—ã-–∏-gpt–ø–æ–¥—Å–∫–∞–∑–∫–∏)

---

## –í–≤–µ–¥–µ–Ω–∏–µ –≤ DWH

üìò –ü—Ä–æ—á–∏—Ç–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã: *DWH ‚Äî Google Docs*  
üí° –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å DWH (Data Warehouse) ‚Äî –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –±–∏–∑–Ω–µ—Å‚Äë—Ä–µ—à–µ–Ω–∏–π.

### üß† –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è
- **ETL (Extract, Transform, Load)** ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.  
- **Staging Layer** ‚Äî —Å–ª–æ–π –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.  
- **Core Layer** ‚Äî —Å–ª–æ–π –æ—á–∏—â–µ–Ω–Ω—ã—Ö –∏ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.  
- **Data Mart Layer** ‚Äî —Å–ª–æ–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–∏—Ç—Ä–∏–Ω.

---

## OLTP vs OLAP

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | OLTP | OLAP |
|-----------------|------|------|
| –¶–µ–ª—å | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –æ–ø–µ—Ä–∞—Ü–∏–∏ | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞, –æ—Ç—á—ë—Ç—ã |
| –°—Ç—Ä—É–∫—Ç—É—Ä–∞ | –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–∞ |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π | –ú–Ω–æ–≥–æ –º–µ–ª–∫–∏—Ö | –ú–µ–Ω—å—à–µ, –Ω–æ –±–æ–ª—å—à–∏—Ö |
| –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | –ß–∞—Å—Ç–æ | –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ |
| –ü—Ä–∏–º–µ—Ä | CRM, ERP | BI, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ |

üí° *–í–∞–∂–Ω–æ:* OLTP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã, OLAP ‚Äî –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö.

### üí° GPT‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∏
> –û–±—ä—è—Å–Ω–∏ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É OLAP –∏ OLTP –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏.  
> –ü—Ä–∏–≤–µ–¥–∏ –ø—Ä–∏–º–µ—Ä —Å–∏—Å—Ç–µ–º—ã, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ç–∏–ø.

---

## –ú–æ–¥–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è DWH

### üß† Kimball vs Inmon

- **–ö–∏–º–±–æ–ª–ª (Kimball):**  
  –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö. –ù–∞—á–∏–Ω–∞–µ–º —Å –≤–∏—Ç—Ä–∏–Ω –¥–∞–Ω–Ω—ã—Ö (Data Marts), –æ–±—ä–µ–¥–∏–Ω—è–µ–º –∏—Ö –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.

- **–ò–Ω–º–æ–Ω (Inmon):**  
  –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑. –°—Ç—Ä–æ–∏–º —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –ø–æ—Ç–æ–º —Å–æ–∑–¥–∞—ë–º –≤–∏—Ç—Ä–∏–Ω—ã.

| –ü–æ–¥—Ö–æ–¥ | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ | –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ |
|---------|---------------|-------------|
| Kimball | –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –ø–æ–Ω—è—Ç–µ–Ω –±–∏–∑–Ω–µ—Å—É | –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–æ–∂–µ–Ω –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏ |
| Inmon | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ | –î–æ–ª–≥–æ –≤–Ω–µ–¥—Ä—è—Ç—å, –¥–æ—Ä–æ–∂–µ |

### üí° GPT‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∏
> –û–±—ä—è—Å–Ω–∏, –∫–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ª—É—á—à–µ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞–ø–∞, –∞ –∫–∞–∫–æ–π ‚Äî –¥–ª—è –∫—Ä—É–ø–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏.

---

## SCD2 –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç—å—é –¥–∞–Ω–Ω—ã—Ö

### üß† –¢–µ–æ—Ä–∏—è

**SCD (Slowly Changing Dimensions)** ‚Äî –º–µ–¥–ª–µ–Ω–Ω–æ –∏–∑–º–µ–Ω—è—é—â–∏–µ—Å—è –∏–∑–º–µ—Ä–µ–Ω–∏—è.

–¢–∏–ø—ã:
- **SCD1** ‚Äî –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–∏—Å—Ç–æ—Ä–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è).  
- **SCD2** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é, –¥–æ–±–∞–≤–ª—è—è –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å `valid_from`, `valid_to`.  
- **SCD3** ‚Äî —Ö—Ä–∞–Ω–∏–º —Ç–µ–∫—É—â–µ–µ –∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ.

### üíª –ü—Ä–∏–º–µ—Ä SCD2

```sql
CREATE TABLE dim_customer (
    customer_id INT,
    customer_name VARCHAR(100),
    region VARCHAR(50),
    valid_from DATE,
    valid_to DATE,
    is_active BOOLEAN
);

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
INSERT INTO dim_customer (customer_id, customer_name, region, valid_from, valid_to, is_active)
VALUES (1, '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤', '–ú–æ—Å–∫–≤–∞', CURRENT_DATE, '9999-12-31', TRUE);

UPDATE dim_customer
SET valid_to = CURRENT_DATE - 1, is_active = FALSE
WHERE customer_id = 1 AND is_active = TRUE;
```

üí° *–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:* —Ç–∞–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞.

### üí° GPT‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∏
> –ü—Ä–∏–¥—É–º–∞–π –ø—Ä–∏–º–µ—Ä, –≥–¥–µ SCD2 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤).  
> –°–ø—Ä–æ—Å–∏ —É GPT, –∫–∞–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ SCD2 –≤ Airflow.

---

## –ú–∏–Ω–∏‚Äë–ø—Ä–æ–µ–∫—Ç: –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ ¬´–∑–≤—ë–∑–¥–æ—á–∫–∞¬ª

### üéØ –¶–µ–ª—å
–°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å DWH –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–¥–∞–∂ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–º–∞–≥–∞–∑–∏–Ω–∞.

### üìã –°–æ—Å—Ç–∞–≤ –ø—Ä–æ–µ–∫—Ç–∞
- –§–∞–∫—Ç —Ç–∞–±–ª–∏—Ü–∞: **fact_sales** ‚Äî –ø—Ä–æ–¥–∞–∂–∏.  
- –ò–∑–º–µ—Ä–µ–Ω–∏—è: **dim_customer**, **dim_product**, **dim_date**, **dim_region**.

### üíª –ü—Ä–∏–º–µ—Ä —Å—Ö–µ–º—ã

```sql
-- –¢–∞–±–ª–∏—Ü–∞ —Ñ–∞–∫—Ç–æ–≤
CREATE TABLE fact_sales (
    sale_id SERIAL PRIMARY KEY,
    product_id INT,
    customer_id INT,
    region_id INT,
    date_id INT,
    amount DECIMAL(10,2),
    quantity INT
);

-- –¢–∞–±–ª–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏–π (–ø—Ä–∏–º–µ—Ä)
CREATE TABLE dim_product (
    product_id INT PRIMARY KEY,
    product_name VARCHAR(100),
    category VARCHAR(50)
);
```

üí° *–°–æ–≤–µ—Ç:* —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ ‚Äî –ø–æ surrogate key (`*_id`).

### üìä –ó–∞–¥–∞—á–∏ –ø—Ä–æ–µ–∫—Ç–∞
1. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å —Å—Ö–µ–º—É ¬´–∑–≤—ë–∑–¥–æ—á–∫–∞¬ª (Star Schema).  
2. –ù–∞–ø–∏—Å–∞—Ç—å SQL‚Äë–∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –ø—Ä–∏–±—ã–ª–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ —Ä–µ–≥–∏–æ–Ω–∞–º.  
3. –î–æ–±–∞–≤–∏—Ç—å SCD2‚Äë–ª–æ–≥–∏–∫—É –≤ –∏–∑–º–µ—Ä–µ–Ω–∏–µ `dim_customer`.

### üíª –ü—Ä–∏–º–µ—Ä –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

```sql
SELECT d.category, r.region_name, SUM(f.amount) AS revenue
FROM fact_sales f
JOIN dim_product d ON f.product_id = d.product_id
JOIN dim_region r ON f.region_id = r.region_id
GROUP BY d.category, r.region_name
ORDER BY revenue DESC;
```

### üí° GPT‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∏
> –ü–æ–ø—Ä–æ—Å–∏ GPT —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å DDL –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü —ç—Ç–æ–π –º–æ–¥–µ–ª–∏.  
> –ü–æ–ø—Ä–æ—Å–∏ –ø—Ä–∏–º–µ—Ä ETL‚Äë—Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ DWH.

---

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ GPT‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∏

1. –ö–∞–∫–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Å–ª–æ–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ DWH?  
2. –ß–µ–º OLAP –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç OLTP?  
3. –ß—Ç–æ —Ç–∞–∫–æ–µ SCD2 –∏ –∑–∞—á–µ–º –æ–Ω–æ –Ω—É–∂–Ω–æ?  
4. –ß—Ç–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–∑ —Å–µ–±—è –º–æ–¥–µ–ª—å ¬´–∑–≤—ë–∑–¥–æ—á–∫–∞¬ª?  
5. –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç–∞–±–ª–∏—Ü–∞ —Ñ–∞–∫—Ç–æ–≤ –∏ —Ç–∞–±–ª–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏–π?  
6. –í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ø–æ–¥—Ö–æ–¥–∞–º–∏ Kimball –∏ Inmon?

üí° *–°–æ–≤–µ—Ç:* –µ—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω ‚Äî —Å–ø—Ä–æ—Å–∏ GPT:  
> ¬´–û–±—ä—è—Å–Ω–∏ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç SCD2¬ª  
> ¬´–ü–æ–º–æ–≥–∏ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å DWH –ø–æ–¥ –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–∞–∂¬ª

---

‚úÖ **–ò—Ç–æ–≥ —Ä–∞–∑–¥–µ–ª–∞:**  
- –ü–æ–Ω–∏–º–∞–µ—à—å –ø—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è DWH –∏ –æ—Ç–ª–∏—á–∏—è OLAP/OLTP.  
- –£–º–µ–µ—à—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ –∑–≤—ë–∑–¥–æ—á–∫–∏ –∏ —Ç–∞–±–ª–∏—Ü—ã —Ñ–∞–∫—Ç–æ–≤/–∏–∑–º–µ—Ä–µ–Ω–∏–π.  
- –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (Spark, HDFS).
